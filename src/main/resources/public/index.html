<!doctype html>
<html lang="en" data-theme="handelsblatt-light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAFESealing â€“ Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <style>
    [data-theme="handelsblatt-light"] {
      --p: 0 92 163; /* Primary: Handelsblatt-Blau */
      --s: 45 99 107; /* Secondary: Dezentes Teal */
      --a: 0 149 158; /* Accent: Lebendiges Blau-GrÃ¼n */
      --n: 59 58 56; /* Neutral: Dunkelgrau */
      --b1: 255 255 255; /* Base: WeiÃŸ */
      --b2: 249 250 251; /* Base 2: Sehr helles Grau */
      --b3: 243 244 246; /* Base 3: Hellgrau */
      --bc: 31 41 55; /* Base Content: Dunkelgrau fÃ¼r Text */
      --in: 59 130 246; /* Info: Blau */
      --su: 16 185 129; /* Success: GrÃ¼n */
      --wa: 251 146 60; /* Warning: Orange */
      --er: 239 68 68; /* Error: Rot */
    }
  </style>
  <script>
    async function postForm(url, form){
      const res = await fetch(url, { method:'POST', body: form });
      const data = await res.json();
      if(!res.ok){ throw new Error(data.error || ('HTTP '+res.status)); }
      return data;
    }

    function b64ToBlob(b64){
      const bin = atob(b64); const u8 = new Uint8Array(bin.length);
      for(let i=0;i<bin.length;i++) u8[i] = bin.charCodeAt(i);
      return new Blob([u8]);
    }

    async function generateKeys(){
      try {
        const data = await fetch('/api/keys/generate', { method:'POST' }).then(r=>r.json());
        document.getElementById('publicKeyPem').value = data.publicKeyPem || '';
        document.getElementById('privateKeyPem').value = data.privateKeyPem || '';
      } catch(e){ alert('Key generation failed: '+e.message); }
    }

    async function doSeal(){
      const form = new FormData();
      const privateKeyPem = document.getElementById('privateKeyPem').value.trim();
      const payloadText = document.getElementById('payloadText').value;
      const payloadFile = document.getElementById('payloadFile').files[0];
      const uniqueId = document.getElementById('uniqueId').value.trim();
      const alg = document.getElementById('alg').value;
      const compression = document.getElementById('compression').checked;
      if(privateKeyPem) form.append('privateKeyPem', privateKeyPem);
      if(payloadFile){ form.append('payload', payloadFile); } else if(payloadText){ form.append('payloadText', payloadText); }
      if(uniqueId) form.append('uniqueId', uniqueId);
      form.append('algorithmVersion', alg);
      form.append('compression', String(compression));
      try{
        const data = await postForm('/api/seal', form);
        const out = document.getElementById('sealOut');
        out.textContent = JSON.stringify(data, null, 2);
        const blob = b64ToBlob(data.base64);
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('sealedDownload');
        link.href = url; link.download = 'sealed.der'; link.style.display='inline-block';
      }catch(e){ alert('Seal failed: '+e.message); }
    }

    async function doReveal(){
      const form = new FormData();
      const publicKeyPem = document.getElementById('publicKeyPem').value.trim();
      const sealedFile = document.getElementById('sealedFile').files[0];
      const sealedBase64 = document.getElementById('sealedBase64').value.trim();
      const alg = document.getElementById('algReveal').value;
      if(publicKeyPem) form.append('publicKeyPem', publicKeyPem);
      if(sealedFile){ form.append('sealed', sealedFile); } else if(sealedBase64){ form.append('sealedBase64', sealedBase64); }
      form.append('algorithmVersion', alg);
      try{
        const data = await postForm('/api/reveal', form);
        document.getElementById('revealOut').textContent = JSON.stringify(data, null, 2);
        const blob = b64ToBlob(data.payloadBase64);
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('payloadDownload');
        link.href = url; link.download = 'payload.bin'; link.style.display='inline-block';
        document.getElementById('payloadPreview').textContent = data.utf8Preview || '';
      }catch(e){ alert('Reveal failed: '+e.message); }
    }
  </script>
  </head>
<body class="bg-base-200 min-h-screen">
  <div class="container mx-auto max-w-6xl px-4 py-8">
    <!-- Header Section -->
    <header class="mb-8">
      <div class="flex items-center justify-between flex-wrap gap-4 mb-2">
        <h1 class="text-3xl font-bold text-base-content">SAFESealing</h1>
        <div class="badge badge-lg badge-outline">
          <span class="font-mono text-xs">Status:</span>
          <span id="health" class="ml-1">checking...</span>
        </div>
      </div>
      <p class="text-base-content/70 text-sm leading-relaxed max-w-2xl">
        Secure cryptographic sealing and revealing demonstration interface. Generate RSA keys for testing or use your own key pair.
      </p>
    </header>

    <!-- Keys Section -->
    <section class="mb-8">
      <div class="card bg-base-100 shadow-lg border border-base-300">
        <div class="card-body">
          <div class="flex items-center justify-between gap-4 flex-wrap mb-4">
            <div>
              <h2 class="card-title text-xl mb-1">ðŸ”‘ Cryptographic Keys</h2>
              <p class="text-sm text-base-content/60">RSA 2048-bit key pair for sealing and revealing operations</p>
            </div>
            <button class="btn btn-primary btn-lg" onclick="generateKeys()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Generate Keys
            </button>
          </div>
          <div class="divider my-2"></div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-sm">Public Key (PEM, X.509)</span>
              </label>
              <textarea 
                id="publicKeyPem" 
                class="textarea textarea-bordered w-full min-h-48 font-mono text-xs leading-relaxed" 
                placeholder="-----BEGIN PUBLIC KEY-----&#10;...&#10;-----END PUBLIC KEY-----">
              </textarea>
            </div>
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-sm">Private Key (PEM, PKCS#8)</span>
              </label>
              <textarea 
                id="privateKeyPem" 
                class="textarea textarea-bordered w-full min-h-48 font-mono text-xs leading-relaxed" 
                placeholder="-----BEGIN PRIVATE KEY-----&#10;...&#10;-----END PRIVATE KEY-----">
              </textarea>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Operations Section -->
    <section>
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <!-- Seal Card -->
        <div class="card bg-base-100 shadow-lg border border-base-300">
          <div class="card-body">
            <h2 class="card-title text-xl mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
              Seal Data
            </h2>
            
            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-medium">Payload File</span>
                <span class="label-text-alt text-base-content/50">optional</span>
              </label>
              <input id="payloadFile" type="file" class="file-input file-input-bordered file-input-primary w-full" />
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-medium">Or Payload Text</span>
              </label>
              <textarea 
                id="payloadText" 
                class="textarea textarea-bordered w-full min-h-32 font-mono text-sm" 
                placeholder="Enter text to seal...">
              </textarea>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-medium text-xs">Unique ID</span>
                  <span class="label-text-alt text-base-content/50">optional</span>
                </label>
                <input 
                  id="uniqueId" 
                  type="text" 
                  class="input input-bordered w-full" 
                  placeholder="e.g. 12345" 
                />
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-medium text-xs">Algorithm Version</span>
                </label>
                <select id="alg" class="select select-bordered w-full">
                  <option value="2" selected>Version 2 (default)</option>
                  <option value="1">Version 1</option>
                </select>
              </div>
            </div>

            <div class="form-control mb-6">
              <label class="label cursor-pointer justify-start gap-3">
                <input id="compression" type="checkbox" class="checkbox checkbox-primary" checked />
                <span class="label-text font-medium">Enable Compression</span>
              </label>
            </div>

            <div class="divider my-2"></div>

            <div class="flex flex-wrap gap-3 mb-4">
              <button class="btn btn-primary btn-block sm:btn-auto" onclick="doSeal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                Seal
              </button>
              <a id="sealedDownload" class="btn btn-outline btn-block sm:btn-auto" style="display:none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Download sealed.der
              </a>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium text-xs">Output</span>
              </label>
              <div class="mockup-code bg-base-200 text-xs">
                <pre id="sealOut" class="text-xs p-4 overflow-x-auto"></pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Reveal Card -->
        <div class="card bg-base-100 shadow-lg border border-base-300">
          <div class="card-body">
            <h2 class="card-title text-xl mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
              </svg>
              Reveal Data
            </h2>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-medium">Sealed File</span>
                <span class="label-text-alt text-base-content/50">optional</span>
              </label>
              <input id="sealedFile" type="file" class="file-input file-input-bordered file-input-secondary w-full" />
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-medium">Or Sealed Base64</span>
              </label>
              <textarea 
                id="sealedBase64" 
                class="textarea textarea-bordered w-full min-h-32 font-mono text-sm" 
                placeholder="Paste base64 encoded sealed data...">
              </textarea>
            </div>

            <div class="form-control mb-6">
              <label class="label">
                <span class="label-text font-medium text-xs">Algorithm Version</span>
              </label>
              <select id="algReveal" class="select select-bordered w-full">
                <option value="2" selected>Version 2 (default)</option>
                <option value="1">Version 1</option>
              </select>
            </div>

            <div class="divider my-2"></div>

            <div class="flex flex-wrap gap-3 mb-4">
              <button class="btn btn-secondary btn-block sm:btn-auto" onclick="doReveal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Reveal
              </button>
              <a id="payloadDownload" class="btn btn-outline btn-block sm:btn-auto" style="display:none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Download payload.bin
              </a>
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-medium text-xs">Output</span>
              </label>
              <div class="mockup-code bg-base-200 text-xs">
                <pre id="revealOut" class="text-xs p-4 overflow-x-auto"></pre>
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium text-xs">Payload Preview</span>
              </label>
              <div class="mockup-code bg-base-200 text-sm">
                <pre id="payloadPreview" class="text-sm p-4 overflow-x-auto whitespace-pre-wrap"></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-12 pt-6 border-t border-base-300">
      <p class="text-xs text-base-content/50 text-center">
        SAFESealing Demo Interface â€¢ Localhost Development Environment
      </p>
    </footer>
  </div>
  <script>
    fetch('/api/health')
      .then(r => r.json())
      .then(j => {
        const healthEl = document.getElementById('health');
        const status = j.status || 'n/a';
        healthEl.textContent = status;
        healthEl.className = status === 'ok' || status === 'healthy' 
          ? 'badge badge-success ml-1' 
          : 'badge badge-warning ml-1';
      })
      .catch(() => {
        const healthEl = document.getElementById('health');
        healthEl.textContent = 'offline';
        healthEl.className = 'badge badge-error ml-1';
      });
  </script>
</body>
</html>


